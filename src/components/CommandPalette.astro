<!-- Command Palette ‚Äî ‚åòK / Ctrl+K -->
<div id="cmd-palette-overlay" class="cmd-overlay" aria-hidden="true">
  <div class="cmd-modal">
    <div class="cmd-input-wrap">
      <svg class="cmd-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input id="cmd-input" class="cmd-input" type="text" placeholder="Type a command‚Ä¶" autocomplete="off" spellcheck="false" />
      <kbd class="cmd-kbd">ESC</kbd>
    </div>
    <div class="cmd-divider"></div>
    <div id="cmd-list" class="cmd-list" role="listbox"></div>
    <div class="cmd-footer">
      <span><kbd>‚Üë‚Üì</kbd> navigate</span>
      <span><kbd>‚Üµ</kbd> select</span>
      <span><kbd>esc</kbd> close</span>
    </div>
  </div>
</div>

<style>
  .cmd-overlay {
    position: fixed; inset: 0; z-index: 9999;
    display: flex; align-items: flex-start; justify-content: center;
    padding-top: min(20vh, 160px);
    background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
    opacity: 0; visibility: hidden;
    transition: opacity .15s ease, visibility .15s ease;
  }
  .cmd-overlay.open { opacity: 1; visibility: visible; }
  .cmd-modal {
    width: 560px; max-width: calc(100vw - 32px);
    border-radius: 14px; overflow: hidden;
    background: var(--surface, #1e1e2e);
    border: 1px solid var(--border, #333);
    box-shadow: 0 16px 70px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.05) inset;
    transform: scale(0.96) translateY(-8px);
    transition: transform .15s ease;
  }
  .cmd-overlay.open .cmd-modal { transform: scale(1) translateY(0); }
  .cmd-input-wrap {
    display: flex; align-items: center; gap: 10px;
    padding: 14px 16px;
  }
  .cmd-search-icon { color: var(--text-2, #888); flex-shrink: 0; }
  .cmd-input {
    flex: 1; background: none; border: none; outline: none;
    font: 15px/1 'Inter', system-ui, sans-serif;
    color: var(--text, #e0e0e0);
  }
  .cmd-input::placeholder { color: var(--text-2, #666); }
  .cmd-kbd {
    font: 11px/1 'JetBrains Mono', monospace;
    padding: 3px 6px; border-radius: 5px;
    background: var(--bg, #111); border: 1px solid var(--border, #333);
    color: var(--text-2, #888);
  }
  .cmd-divider { height: 1px; background: var(--border, #333); }
  .cmd-list {
    max-height: 340px; overflow-y: auto; padding: 6px;
    scrollbar-width: thin; scrollbar-color: var(--border, #333) transparent;
  }
  .cmd-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 12px; border-radius: 8px; cursor: pointer;
    font: 14px/1.2 'Inter', system-ui, sans-serif;
    color: var(--text, #e0e0e0);
    transition: background .08s ease;
  }
  .cmd-item.active { background: var(--accent-bg, rgba(99,102,241,0.15)); color: var(--accent, #818cf8); }
  .cmd-item-icon { font-size: 16px; width: 24px; text-align: center; flex-shrink: 0; }
  .cmd-item-label { flex: 1; }
  .cmd-item-hint {
    font: 12px/1 'JetBrains Mono', monospace;
    color: var(--text-2, #666);
  }
  .cmd-footer {
    display: flex; gap: 16px; padding: 10px 16px;
    border-top: 1px solid var(--border, #333);
    font: 11px/1 'Inter', system-ui, sans-serif;
    color: var(--text-2, #666);
  }
  .cmd-footer kbd {
    font-family: 'JetBrains Mono', monospace;
    padding: 1px 4px; border-radius: 3px;
    background: var(--bg, #111); border: 1px solid var(--border, #333);
    font-size: 10px;
  }
</style>

<script is:inline>
(function() {
  const commands = [
    { icon: 'üè†', label: 'Home', action: '/', type: 'nav' },
    { icon: 'üíº', label: 'Work', action: '/#work', type: 'nav' },
    { icon: 'üë§', label: 'About', action: '/#about', type: 'nav' },
    { icon: 'üì∑', label: 'Photos', action: '/photos', type: 'nav' },
    { icon: 'üìù', label: 'Writing', action: '/writing', type: 'nav' },
    { icon: 'üìß', label: 'Contact', action: '/#contact', type: 'nav' },
    { icon: 'üîó', label: 'GitHub', action: 'https://github.com/quakeob', type: 'ext', hint: 'github.com' },
    { icon: 'üîó', label: 'X / Twitter', action: 'https://x.com/Jak3dev', type: 'ext', hint: 'x.com' },
    { icon: 'üé®', label: 'Theme: Default', action: 'default', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Minimal', action: 'minimal', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Terminal', action: 'terminal', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Glass', action: 'glass', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Brutalist', action: 'brutalist', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Noir', action: 'noir', type: 'theme' },
    { icon: 'üé®', label: 'Theme: Retro', action: 'retro', type: 'theme' },
    { icon: 'üé®', label: 'Theme: OG', action: 'og', type: 'theme' },
  ];

  const overlay = document.getElementById('cmd-palette-overlay');
  const input = document.getElementById('cmd-input');
  const list = document.getElementById('cmd-list');
  let active = 0, filtered = [...commands];

  function fuzzy(text, query) {
    let qi = 0;
    const tl = text.toLowerCase(), ql = query.toLowerCase();
    for (let i = 0; i < tl.length && qi < ql.length; i++) {
      if (tl[i] === ql[qi]) qi++;
    }
    return qi === ql.length;
  }

  function render() {
    list.innerHTML = '';
    filtered.forEach((cmd, i) => {
      const el = document.createElement('div');
      el.className = 'cmd-item' + (i === active ? ' active' : '');
      el.setAttribute('role', 'option');
      el.innerHTML = `<span class="cmd-item-icon">${cmd.icon}</span><span class="cmd-item-label">${cmd.label}</span>${cmd.hint ? `<span class="cmd-item-hint">${cmd.hint}</span>` : ''}`;
      el.addEventListener('click', () => execute(cmd));
      el.addEventListener('mouseenter', () => { active = i; render(); });
      list.appendChild(el);
    });
  }

  function execute(cmd) {
    close();
    if (cmd.type === 'theme') {
      if (cmd.action === 'default') {
        document.documentElement.removeAttribute('data-theme');
        localStorage.removeItem('jd-theme');
      } else {
        document.documentElement.setAttribute('data-theme', cmd.action);
        localStorage.setItem('jd-theme', cmd.action);
      }
    } else if (cmd.type === 'ext') {
      window.open(cmd.action, '_blank');
    } else {
      window.location.href = cmd.action;
    }
  }

  function open() {
    overlay.classList.add('open');
    overlay.setAttribute('aria-hidden', 'false');
    input.value = '';
    active = 0;
    filtered = [...commands];
    render();
    requestAnimationFrame(() => input.focus());
  }

  function close() {
    overlay.classList.remove('open');
    overlay.setAttribute('aria-hidden', 'true');
  }

  input.addEventListener('input', () => {
    const q = input.value.trim();
    filtered = q ? commands.filter(c => fuzzy(c.label, q)) : [...commands];
    active = 0;
    render();
  });

  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      overlay.classList.contains('open') ? close() : open();
    }
    if (!overlay.classList.contains('open')) return;
    if (e.key === 'Escape') { e.preventDefault(); close(); }
    if (e.key === 'ArrowDown') { e.preventDefault(); active = (active + 1) % filtered.length; render(); list.children[active]?.scrollIntoView({ block: 'nearest' }); }
    if (e.key === 'ArrowUp') { e.preventDefault(); active = (active - 1 + filtered.length) % filtered.length; render(); list.children[active]?.scrollIntoView({ block: 'nearest' }); }
    if (e.key === 'Enter' && filtered[active]) { e.preventDefault(); execute(filtered[active]); }
  });

  overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });
})();
</script>
