---
---
<section id="activity" class="py-24 px-6">
  <div class="max-w-6xl mx-auto">
    <div class="reveal mb-10">
      <p class="text-sm font-medium tracking-widest uppercase mb-3" style="color: var(--accent);">Recent Activity</p>
      <h2 class="text-3xl md:text-4xl font-bold tracking-tight" style="color: var(--text);">What I've been building<span style="color: var(--accent);">.</span></h2>
    </div>
    <div id="github-activity" class="gh-activity">
      <div class="gh-loading" style="color: var(--text-3); font-size: 0.875rem;">Loading activity...</div>
    </div>
  </div>
</section>

<style>
  .gh-activity {
    max-width: 640px;
  }
  .gh-event {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    padding: 0.5rem 0;
    font-size: 0.875rem;
    line-height: 1.5;
    border-bottom: 1px solid var(--border);
  }
  .gh-event:last-child { border-bottom: none; }
  .gh-dot {
    flex-shrink: 0;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent);
    position: relative;
    top: 0.35rem;
  }
  .gh-content { flex: 1; min-width: 0; }
  .gh-repo { font-weight: 600; color: var(--text); }
  .gh-action { color: var(--text-2); }
  .gh-msg { color: var(--text-3); }
  .gh-time {
    flex-shrink: 0;
    font-size: 0.75rem;
    color: var(--text-3);
    white-space: nowrap;
  }
  .gh-error { color: var(--text-3); font-size: 0.875rem; }

  /* Terminal theme */
  :global([data-theme="terminal"]) .gh-event {
    font-family: var(--font-mono);
    border-bottom-color: transparent;
    flex-direction: column;
    gap: 0.125rem;
    padding: 0.375rem 0;
  }
  :global([data-theme="terminal"]) .gh-dot { display: none; }
  :global([data-theme="terminal"]) .gh-time { font-size: 0.875rem; }
</style>

<script is:inline>
(function() {
  var container = document.getElementById('github-activity');
  if (!container) return;

  function relTime(d) {
    var s = Math.floor((Date.now() - new Date(d).getTime()) / 1000);
    if (s < 60) return 'just now';
    if (s < 3600) return Math.floor(s / 60) + 'm ago';
    if (s < 86400) return Math.floor(s / 3600) + 'h ago';
    if (s < 172800) return 'yesterday';
    return Math.floor(s / 86400) + 'd ago';
  }

  function short(name) { return name ? name.replace('quakeob/', '') : name; }

  function parse(ev) {
    var repo = ev.repo ? ev.repo.name : '', s = short(repo), p = ev.payload || {};
    switch (ev.type) {
      case 'PushEvent':
        var msg = (p.commits && p.commits[0]) ? p.commits[0].message.split('\n')[0] : '';
        var branch = p.ref ? p.ref.replace('refs/heads/', '') : 'main';
        return { repo: s, action: 'Pushed to', detail: msg ? ' â€” "' + msg + '"' : '', cmd: 'git push origin ' + branch, sub: repo + ': "' + msg + '"' };
      case 'CreateEvent':
        return { repo: s, action: 'Created ' + (p.ref_type || '') + (p.ref ? ' ' + p.ref : '') + ' in', detail: '', cmd: 'git branch ' + (p.ref || ''), sub: repo };
      case 'PullRequestEvent':
        return { repo: s, action: 'Opened PR in', detail: '', cmd: 'gh pr create', sub: repo };
      case 'IssuesEvent':
        return { repo: s, action: 'Opened issue in', detail: '', cmd: 'gh issue create', sub: repo };
      default: return null;
    }
  }

  function isTerm() { return document.documentElement.getAttribute('data-theme') === 'terminal'; }

  function render(events) {
    var items = [];
    for (var i = 0; i < events.length && items.length < 6; i++) {
      var p = parse(events[i]);
      if (p) { p.time = relTime(events[i].created_at); items.push(p); }
    }
    if (!items.length) { container.innerHTML = '<div class="gh-error">No recent activity.</div>'; return; }
    var t = isTerm();
    container.innerHTML = items.map(function(e) {
      if (t) return '<div class="gh-event"><span class="gh-content"><span style="color:var(--text-3)">$ </span><span style="color:var(--accent)">' + e.cmd + '</span>  <span class="gh-time">// ' + e.time + '</span></span><span class="gh-content"><span style="color:var(--text-3)">&gt; </span><span class="gh-msg">' + e.sub + '</span></span></div>';
      return '<div class="gh-event"><span class="gh-dot"></span><span class="gh-content"><span class="gh-action">' + e.action + ' </span><span class="gh-repo">' + e.repo + '</span><span class="gh-msg">' + e.detail + '</span></span><span class="gh-time">' + e.time + '</span></div>';
    }).join('');
  }

  fetch('https://api.github.com/users/quakeob/events?per_page=8')
    .then(function(r) { return r.json(); })
    .then(function(data) {
      window.__ghEvents = data;
      render(data);
    })
    .catch(function() { container.innerHTML = '<div class="gh-error">Couldn\'t load activity.</div>'; });

  new MutationObserver(function() {
    if (window.__ghEvents) render(window.__ghEvents);
  }).observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
})();
</script>
